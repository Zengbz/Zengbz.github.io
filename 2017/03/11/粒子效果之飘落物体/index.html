<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>粒子效果之飘落物体 | 曾炳忠</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">粒子效果之飘落物体</h1><a id="logo" href="/.">曾炳忠</a><p class="description">我的个人博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 导航</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">粒子效果之飘落物体</h1><div class="post-meta">Mar 11, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/03/11/粒子效果之飘落物体/" href="/2017/03/11/粒子效果之飘落物体/#comments" class="ds-thread-count"></a><div class="post-content"><p>模拟物体飘落壮的粒子效果，本文模拟下雪效果。</p>
<p>在模拟自然界物体飘落（或者向上飘）时候，该物体自然会受到物理规律的作用，例如重力，风力作用的偏移等等。本次实现中，模拟下雪效果我们给雪加上了重力作用、偏移方向、飘落速度、雪的厚度（深度）、雪的数量（粒子数量）。以下为实现代码：</p>
<p>头文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">#pragma once</div><div class="line">#include &quot;Particle_base.h&quot;</div><div class="line">struct Partice_rain</div><div class="line">&#123;</div><div class="line">	//是否激活</div><div class="line">	bool	active;</div><div class="line">	//坐标</div><div class="line">	float2  pos;</div><div class="line">	//颜色</div><div class="line">	float4  color;</div><div class="line">	//速度</div><div class="line">	float2	posspeed;</div><div class="line">	//重力加速度</div><div class="line">	float2	posgravity;</div><div class="line">	//深度层次</div><div class="line">	int	    depth;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">class Partic_rain</div><div class="line">&#123;</div><div class="line">public:</div><div class="line">	Partic_rain(void);</div><div class="line">	~Partic_rain(void);</div><div class="line"></div><div class="line">	void	Init(CytResource *pres,Anima_Data *Animadata,float2 field,int ParticleNum);</div><div class="line">	void	CheckInitdata(float2 field,int ParticleNum);</div><div class="line">	void	Update();</div><div class="line">	void	Render();</div><div class="line"></div><div class="line">	//下降的速度</div><div class="line">	void	Setspeed(float2 speed);</div><div class="line">	//下降的最低速度</div><div class="line">	void	SetMixspeed(float2 minspeed);</div><div class="line">	//粒子的层次深度</div><div class="line">	void	SetDepth(int depth);</div><div class="line">	//粒子的重力偏移</div><div class="line">	void	SetGravity(float2 gravity);</div><div class="line">	//粒子的个数</div><div class="line">	void	SetParticleNum(int iNum);</div><div class="line">	//粒子整体偏移量</div><div class="line">	void	SetOffset(float2 offset);</div><div class="line"></div><div class="line">private:</div><div class="line"></div><div class="line">	//粒子数据</div><div class="line">	Partice_rain		m_Paiticle[MAXPARTICLE];	</div><div class="line">	//粒子的范围，宽和高</div><div class="line">	float2		m_field;</div><div class="line">	//定义数量</div><div class="line">	int			m_iParticle_Num;</div><div class="line">	//粒子的动画</div><div class="line">	CSDLAnimation *m_pParticleAnima[MAXPARTICLE];</div><div class="line">	//动画缩放</div><div class="line">	float2		m_Scale;</div><div class="line">	//动画角度</div><div class="line">	float		m_Rot;</div><div class="line">	//生命周期</div><div class="line">	float		m_life;</div><div class="line">	//当前个数</div><div class="line">	int			m_curnum;</div><div class="line">	//速度</div><div class="line">	float2		m_speed;</div><div class="line">	//最低速度</div><div class="line">	float2		m_minSpeed;</div><div class="line">	//场景偏移</div><div class="line">	float2		m_offset;</div><div class="line">	//深度</div><div class="line">	int			m_Depth;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>实现部分：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line">#include &quot;Partic_rain.h&quot;</div><div class="line"></div><div class="line"></div><div class="line">Partic_rain::Partic_rain(void)</div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">Partic_rain::~Partic_rain(void)</div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Partic_rain::Init( CytResource *pres,Anima_Data *Animadata,float2 field,int ParticleNum )</div><div class="line">&#123;</div><div class="line">	int i;</div><div class="line">	m_field = field;</div><div class="line">	m_iParticle_Num = ParticleNum;</div><div class="line">	m_speed = float2(0.0,1.0);</div><div class="line">	m_minSpeed = float2(0.0,1.0);</div><div class="line">	m_Depth = 5;</div><div class="line">	Texture *ht;</div><div class="line">	ht = pres-&gt;GetTexturebyname(Animadata-&gt;texture);</div><div class="line">	for (i=0;i&lt;m_iParticle_Num;i++)</div><div class="line">	&#123;</div><div class="line">		m_Paiticle[i].active = false;</div><div class="line">		m_Paiticle[i].posspeed.x = float(rand()%(int)(1000*m_speed.x+1));</div><div class="line">		m_Paiticle[i].posspeed.y = float((rand()%(int)(1000*m_speed.y+1))+1000*m_minSpeed.y);</div><div class="line">		m_Paiticle[i].posgravity.x = 0.0f;</div><div class="line">		m_Paiticle[i].posgravity.y = 1.0f;</div><div class="line">		m_Paiticle[i].pos.x =	rand()%(int)(m_field.x+1);</div><div class="line">		m_Paiticle[i].pos.y =	rand()%(int)(m_field.y+1);</div><div class="line">		m_Paiticle[i].depth = rand()%m_Depth;</div><div class="line"></div><div class="line">		m_pParticleAnima[i] = new CSDLAnimation(ht,Animadata-&gt;frames,Animadata-&gt;fps,Animadata-&gt;x,Animadata-&gt;y,Animadata-&gt;w,Animadata-&gt;h);</div><div class="line">		m_pParticleAnima[i] -&gt;SetHotSpot(Animadata-&gt;w*Animadata-&gt;hotX,Animadata-&gt;h*Animadata-&gt;hotY);</div><div class="line">	&#125;</div><div class="line">	m_Scale.x  = Animadata-&gt;hscale;</div><div class="line">	m_Scale.y  = Animadata-&gt;vscale;</div><div class="line">	m_offset = float2(0.0001,0.0001);</div><div class="line">	m_Rot	   = 0;</div><div class="line">	m_curnum   = 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Partic_rain::Update()</div><div class="line">&#123;</div><div class="line">	int i;</div><div class="line">	if (m_curnum&lt;m_iParticle_Num)</div><div class="line">	&#123;</div><div class="line">		m_Paiticle[m_curnum].active = true;</div><div class="line">	&#125;</div><div class="line">	for (i=0;i&lt;m_iParticle_Num;i++)</div><div class="line">	&#123;</div><div class="line">		if (m_Paiticle[i].active)</div><div class="line">		&#123;</div><div class="line">			m_Paiticle[i].pos.x += m_Paiticle[i].posspeed.x/1000;</div><div class="line">			m_Paiticle[i].pos.y += m_Paiticle[i].posspeed.y/1000;</div><div class="line"></div><div class="line">			m_Paiticle[i].posspeed.x += m_Paiticle[i].posgravity.x;</div><div class="line">			m_Paiticle[i].posspeed.y += m_Paiticle[i].posgravity.y;</div><div class="line">			if (m_Paiticle[i].pos.y&gt;SCREENHEIGHT)</div><div class="line">			&#123;</div><div class="line">				m_Paiticle[i].pos.x = rand()%(int)(m_field.x+1);</div><div class="line">				m_Paiticle[i].pos.y = rand()%(int)(m_field.y+1);</div><div class="line">				m_Paiticle[i].posspeed.x = float(rand()%(int)(1000*m_speed.x+1));</div><div class="line">				m_Paiticle[i].posspeed.y = float((rand()%(int)(1000*m_speed.y+1))+1000*m_minSpeed.y);</div><div class="line">				m_Paiticle[i].depth = rand()%m_Depth;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	if(m_curnum&lt;m_iParticle_Num+1)</div><div class="line">	&#123;</div><div class="line">		m_curnum++;	</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">float   g_scale[10]= &#123;1.0,0.9,0.8,0.7,0.6,0.5,0.4,0.3,0.2,0.1&#125;;</div><div class="line">void Partic_rain::Render()</div><div class="line">&#123;</div><div class="line">	int i;</div><div class="line"></div><div class="line">	for (i=0;i&lt;m_iParticle_Num;i++)</div><div class="line">	&#123;</div><div class="line">		if (m_Paiticle[i].active)</div><div class="line">		&#123;</div><div class="line">			//glClear(GL_DEPTH_BUFFER_BIT);</div><div class="line">			m_pParticleAnima[i]-&gt;RenderEx(m_Paiticle[i].pos.x+m_offset.x,m_Paiticle[i].pos.y+m_offset.y,</div><div class="line">										 m_Rot,</div><div class="line">										 m_Scale.x*g_scale[m_Paiticle[i].depth],</div><div class="line">										 m_Scale.y*g_scale[m_Paiticle[i].depth]);</div><div class="line">			//eglSwapBuffers(_display,_surface);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">void Partic_rain::SetGravity( float2 gravity )</div><div class="line">&#123;</div><div class="line">	int i;</div><div class="line">	for (i=0;i&lt;m_iParticle_Num;i++)</div><div class="line">	&#123;</div><div class="line">		m_Paiticle[i].posgravity = gravity;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Partic_rain::Setspeed( float2 speed )</div><div class="line">&#123;</div><div class="line"></div><div class="line">	m_speed = speed;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">void Partic_rain::SetMixspeed(float2 minspeed)</div><div class="line">&#123;</div><div class="line">	m_minSpeed = minspeed;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Partic_rain::SetDepth(int depth)</div><div class="line">&#123;</div><div class="line">	m_Depth = depth;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Partic_rain::SetParticleNum(int iNum)</div><div class="line">&#123;</div><div class="line">	m_iParticle_Num = iNum;</div><div class="line">&#125;</div><div class="line">	</div><div class="line">void Partic_rain::SetOffset(float2 offset)</div><div class="line">&#123;</div><div class="line">	m_offset = offset;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<iframe height="540" width="455" src="http://uploadgif.55.la/upload/temp/2017/03/14/15/2219433756.gif"></iframe></div><div class="tags"><a href="/tags/研究实现/">研究实现</a></div><div class="post-nav"><a href="/2017/03/11/欢乐斗牛/" class="pre">游戏Demo1.斗牛游戏</a></div><div data-thread-key="2017/03/11/粒子效果之飘落物体/" data-title="粒子效果之飘落物体" data-url="http://yoursite.com/2017/03/11/粒子效果之飘落物体/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/03/11/粒子效果之飘落物体/" data-title="粒子效果之飘落物体" data-url="http://yoursite.com/2017/03/11/粒子效果之飘落物体/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/项目/" style="font-size: 15px;">项目</a> <a href="/tags/研究实现/" style="font-size: 15px;">研究实现</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/15/Page简历/">个人简历</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/14/3D渲染引擎的实现尝试/">OpenGL ES 2.0环境下3D渲染引擎实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/14/Box2D物理引擎搭建和应用/">Box2D物理引擎搭建和应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/13/3D足球/">游戏Demo4.3D足球</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/12/音乐派对/">游戏Demo3.音乐派对</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/西游龙宫-大鱼吃小鱼/">游戏Demo2.西游龙宫</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/欢乐斗牛/">游戏Demo1.斗牛游戏</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/粒子效果之飘落物体/">粒子效果之飘落物体</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-commt"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:null" target="_blank" class="fa fa-email"> </a><a href="http://weibo.com/2532203704/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/Zengbz" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">zbz</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var duoshuoQuery = {short_name:'zengbz'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    document.getElementsByTagName('body')[0].appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.json.js?v=1.2.0"></script></body></html>